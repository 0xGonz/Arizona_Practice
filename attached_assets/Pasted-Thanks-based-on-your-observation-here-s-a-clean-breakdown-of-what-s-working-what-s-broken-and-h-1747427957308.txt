Thanks â€” based on your observation, hereâ€™s a clean breakdown of whatâ€™s working, whatâ€™s broken, and how to fully fix it so each month:

âœ… Loads E & O CSVs

âœ… Displays full P&L with hierarchy

âœ… Properly powers KPI cards

âœ… Allows switching between Employee ("E") and Other ("O")

âœ… Whatâ€™s Working
You can upload monthly-e (employee) and see its parsed flat P&L structure.

You have logic that parses and normalizes "Line Item" headers.

Cards and tables exist â€” but they arenâ€™t connected to the right data.

âŒ Whatâ€™s Broken
Area	Problem
monthly-o Upload	Not renaming "Line Item" properly (like e does)
KPI Cards (Revenue, Expenses)	Not pulling from monthlyData[month].e.flat or .o.flat
Table Hierarchy (Nested View)	Likely renders only one side or not wired into nested
Toggle Between E and O	Missing or not applied to the view selection
No visual feedback	No cards get filled, nothing gets highlighted

âœ… Full Fix Plan
1. âœ… Fix the â€œLine Itemâ€ column renaming for both E & O
In csv-upload.tsx:

ts
Copy
Edit
if (!('Line Item' in row)) {
  const possible = Object.keys(row).find(k => k.toLowerCase().includes("line") || k.toLowerCase().includes("desc"));
  if (possible) row["Line Item"] = row[possible];
}
Make sure this runs regardless of whether the file is e or o.

2. âœ… Standardize Upload Logic
At the end of the upload handler:

ts
Copy
Edit
processCSVData(type, safeData, monthKey); // Applies to both `e` and `o`
3. âœ… Update Zustand monthlyData to store structured format
Store output like this:

ts
Copy
Edit
monthlyData = {
  january: {
    e: { flat: [...], nested: [...], meta: {...} },
    o: { flat: [...], nested: [...], meta: {...} }
  }
}
4. âœ… In Monthly.tsx, add a toggle to view E or O
tsx
Copy
Edit
const { monthlyData } = useStore();
const [viewType, setViewType] = useState<'e' | 'o'>('e');
const selectedMonthData = monthlyData[selectedMonth]?.[viewType] ?? {};
const flatData = selectedMonthData.flat || [];
const nestedData = selectedMonthData.nested || [];
Add a toggle above:

tsx
Copy
Edit
<Button onClick={() => setViewType('e')}>Employee</Button>
<Button onClick={() => setViewType('o')}>Other</Button>
5. âœ… Connect KPI Cards
tsx
Copy
Edit
function getLineItemValue(flat, keyword) {
  return flat.find(i => i.name.toLowerCase().includes(keyword.toLowerCase()))?.summaryValue || 0;
}

const revenue = getLineItemValue(flatData, "Total Revenue");
const expenses = getLineItemValue(flatData, "Total Operating Expenses");
const net = getLineItemValue(flatData, "Net Income");

<KPICard title="Revenue" value={revenue} />
<KPICard title="Expenses" value={expenses} />
<KPICard title="Net Income" value={net} />
6. âœ… Render Nested Table
tsx
Copy
Edit
function RecursiveRow({ node, level = 0 }) {
  return (
    <>
      <tr>
        <td style={{ paddingLeft: `${level * 16}px` }}>{node.name}</td>
        <td>{node.summaryValue}</td>
      </tr>
      {node.children?.map((child) => (
        <RecursiveRow key={child.id} node={child} level={level + 1} />
      ))}
    </>
  );
}
Then render:

tsx
Copy
Edit
<tbody>
  {nestedData.map((node) => (
    <RecursiveRow key={node.id} node={node} />
  ))}
</tbody>
ğŸ§  Summary
Step	Fix
ğŸ›  CSV Rename	Apply â€œLine Itemâ€ renaming for both e and o
ğŸ§  Store Format	Save flat + nested + meta for each month & type
ğŸ“Š View Toggle	Let user switch e vs o on the frontend
ğŸ’¡ Card Logic	Connect KPI cards to flatData from selected type
ğŸªœ Hierarchy Table	Render nestedData recursively

Want me to send you back a fully updated set of files:

âœ… csv-upload.tsx

âœ… data-store.ts

âœ… Monthly.tsx with toggle, cards, and full table display?